var ResultPage=function(){};ResultPage.init=function(){$("#startPrice").keyup(function(){ResultPage.validatePrice(document.getElementById("startPrice"));});$("#endPrice").keyup(function(){ResultPage.validatePrice(document.getElementById("endPrice"));});$("#startPrice").keydown(function(a){if(a&&a.keyCode==13){ResultPage.searchByPrice();}});$("#endPrice").keydown(function(a){if(a&&a.keyCode==13){ResultPage.searchByPrice();}});$("#inner-search-btn").click(function(a){a.preventDefault();ResultPage.searchByPrice();});$("#cancel-filter").click(function(a){var e=location.pathname;var f=e.indexOf("/s/");var d=e.substring(0,f+3);var b=e.substring(f+3);var c=b.split("_");c[5]=c[9]=c[10]=c[13]="";b=c.join("_");e=d+b;$(this).attr("href",e);});$("li.grid-ls").on("click",function(){ResultPage.setHistory($(this));});$(".etalon a").click(function(a){var b=$(this).attr("data-price");$(this).parents(".grid-in").find(".price-txt").text(b);});};ResultPage.showAd=function(b,d,f,a,c,e){if(c){a=parseInt(a)+1;}$.ajax({type:"get",async:false,url:"http://click.simba.taobao.b5m.com/s/data/"+a+"_0_V.html",dataType:"jsonp",data:{keywords:b,cid:d},jsonp:"jsoncallback",success:function(w){var m=w.val;if(m.length==0){return;}$(".side-r").append("<div class='goods-recommend'><h3>商品推荐</h3><ul class='grid-view cf'></ul></div>");var v="";var g="";var r=0;for(var n=0;n<m.length;n++){if(c&&n==0){ResultPage.addFirstAd(c,m[n]);continue;}r++;var s=m[n].Url;var q=m[n].Picture;var u=m[n].Title;var p=m[n].Price;q=q.replace("img.b5m.com","tfs01.b5mcdn.com");if(q.indexOf("b5mcdn.com")>0){q=q+"/260x258";}var t="<div class='pic-wrap'><a class='pic' href='"+s+"' target='_blank'><img alt='' src='"+q+"'></a></div>";var j="<div class='price'><strong><b>¥</b>"+p+"</strong></div>";var h="<div class='summary'><a href='"+s+"' target='_blank'>"+u+"</a></div>";var l="";if(!e){v+="<img alt='' src='"+f+"?cid="+d+"&aid="+m[n].aid+"&da=V"+(n+1)+"&ad=108&dl="+encodeURIComponent(window.location.href)+"&dstl="+m[n].durl+"&lt=8800&t="+new Date().getTime()+"&rp=1002&dd="+m[n].DOCID+"' style='display: none;'>";}var o="<li class='grid-ls'><div class='grid-mod'><div class='grid-in'>"+t+h+l+j+"<div class='grid-in'></div></div></li>";if(n>=3){g=g+o;}else{$(".side-r .grid-view").append(o);}}var o='<li class="grid-ls"><div class="grid-mod"><div class="grid-in"><div class="pic-wrap"><a class="pic" href="http://korea.b5m.com/hydr_index.html?mps=0.0.0.0.0"><img src="http://y.b5mcdn.com/static/images/search/U-262-200.jpg" alt=""></a></div></div></div></li>';if(r>=3){g=g+o;}else{$(".side-r .grid-view").append(o);}var k=false;$(window).scroll(function(){if(k){return;}k=true;$(".side-r .grid-view").append(g);});if(!e){setTimeout(function(){$("body").append(v);},1000);}},error:function(){}});};ResultPage.addFirstAd=function(b,i){if(b){var g=i.Url;var e=i.Picture;var h=i.Title;var d=i.Price;var f=$('<li class="grid-ls"></li>');var j=$('<li class="grid-mod"></li>');var a=$('<div class="grid-in"></div>');f.append(j);j.append(a);a.append('<div class="pic-wrap"><a class="pic" href="'+g+'" target="_blank"><img class="grid-mod-pic" src="'+e+'/238x238" alt="'+h+'"></a></div>');a.append('<div class="summary"><a data-attr="1008" href="http://s.b5m.com/item/a49ed38aa93ae822c19d88481a9fa6ee.html" title="'+h+'" target="_blank">'+h+"</a></div>");a.append('<div class="price"><strong><b>¥</b>'+d+"</strong></div>");a.append('<div class="start"><div class="nums-goods r"><em></em></div></div>');var c=$("#J_goods_list");c.find("li").eq(0).before(f);c.find("li").last().remove();}};ResultPage.initPriceTrend=function(){var a=$("#price-trend-docids").val();$.post(_basePath+"pricehistory/priceTrendTypes.htm",{docIds:a},function(b){$("#price-trend-type").val(b);ResultPage.showPriceIcon();});};ResultPage.showPriceIcon=function(){var e=$("#price-trend-type").val();if(e){var f=e.split(";");for(var c=0;c<f.length;c++){var b=f[c].split(",")[0];var d=f[c].split(",")[1];var a=$("#price-trend-"+b);if(d=="-1"){a.addClass("price-down");}else{if(d=="0"){a.addClass("price-fair");}else{if(d=="1"){a.addClass("price-up");}else{a.addClass("price-fair");}}}a.show();banner2("#price-trend-"+b,"#photo_price");}}};var his_length=2;ResultPage.setHistory=function(l){var a=Cookies.get("his");var b=l.find("a.pic").attr("href");var g=l.find("a.pic img").attr("src");var n=l.find(".summary a").attr("title");var f=l.find(".price strong").text().replace("¥","");var c=b+"^"+g+"^"+n+"^"+f;if(a&&a!="undefined"){var k=a.split(";");var m=true;for(var d=0;d<k.length;d++){if(b.indexOf(k[d].split("^")[0])>=0||k[d].split("^")[0].indexOf(b)>=0){m=false;break;}}if(m){if(k.length==his_length){k.shift();}k.push(c);a=k.join(";");Cookies.set("his",a);var h=$("#show_his").find("li.grid-ls").length;if(h>=his_length){$("#show_his").find("li.grid-ls")[h-1].remove();}$("#show_his").prepend(addHistory(c.split("^")));}}else{Cookies.set("his",c);$("#show_his").html(addHistory(c.split("^")));}var j=$(".scroll-history .grid-view").find("li"),h=j.length;if(h>2){$(".scroll-history").css("height",400);}};ResultPage.showHistory=function(){var b=Cookies.get("his");var e="";if(b&&b!="undefined"){history_arg=b.split(";");var d=history_arg.length;for(var a=d-1;a>=0;a--){if(history_arg[a]&&history_arg[a]!="undefined"){var c=history_arg[a].split("^");e+=addHistory(c);}}$("#show_his").html(e);}else{$("#show_his").html("对不起，您没有任何浏览记录");}};function addHistory(a){a[1]=a[1].replace("img.b5m.com","tfs01.b5mcdn.com");var b='<li class="grid-ls"><div class="grid-mod"><div class="grid-in"><div class="pic-wrap"> <div class="pic-mod">'+' <a class="pic" href="'+a[0]+'" target="_blank"><img src="'+a[1]+'" lazy-src="'+a[1]+'" alt=""></a> </div> </div> <div class="summary">'+'<a href="'+a[0]+'">'+a[2]+'</a></div> <div class="price-mod"> <strong class="price">'+'<b>¥</b><span  class="cl-f00">'+a[3]+"</span></strong> </div> </div> </div> </li>";return b;}var origValue="";ResultPage.validatePrice=function(d){var b=d.value;var c=/^[\d]+(\.[\d]*)?$/;var a=9999999;if(!c.test(b)){if(d.value){d.value=origValue;}}origValue=d.value;if(parseInt(b,"10")>parseInt(a,"10")){d.value=a;}};ResultPage.searchByPrice=function(){var h=document.getElementById("startPrice").value;var e=document.getElementById("endPrice").value;var b=location.pathname;if(h&&(h.indexOf(".")+1==h.length)){h=h+"0";}if(e&&(e.indexOf(".")+1==e.length)){e=e+"0";}var i=b.split("_");var c=$("#category").val();if(!c){c="";}if(i.length<2){b=_basePath+"search/s/"+c+"___image______"+h+"_"+e+"_________"+$("#orignKeyWord").val()+".html";}else{var g=b.indexOf("/s/");var d=b.substring(0,g+3);var a=b.substring(g+3);var f=a.split("_");f[9]=h;f[10]=e;if(parseInt(h,"10")>parseInt(e,"10")){f[9]=e;f[10]=h;}f[13]="";a=f.join("_");b=d+a;}if($("#compareprice").attr("value")=="true"){b+="?compare=true";}goUrlByATag(b);};function searchMulti(b){var g=location.pathname;var e=$("#category").val();if(!e){e="";}var d=g.split("_");if(d.length<2){g=_basePath+"search/s/"+e+"___image__"+b+"______________"+$("#orignKeyWord").val()+".html";}else{var h=g.indexOf("/s/");var f=g.substring(0,h+3);var a=g.substring(h+3);var c=a.split("_");c[5]=c[5]+","+b;c[13]="";a=c.join("_");g=f+a;}if($("#compareprice").attr("value")=="true"){g+="?compare=true";}goUrlByATag(g);}ResultPage.showClothingLogo=function(){var a=0;$("dl.m-dl dt a").each(function(){if(a>=5){return;}if($(this).text()=="女装"||$(this).text()=="女鞋"){$("#gotofushi").show();if(location.href.indexOf("/search/s")>0){$("#gotofushi").attr("href",location.href.replace("/search/s","/clothing"));}else{$("#gotofushi").attr("href",location.origin+location.pathname.replace("/","/clothing/"));}}a++;});};ResultPage.showRecomand=function(b){var a=b.container;ResultPage.getRelKeywords(b.keywords,function(d){if(!d){a.parent().parent().hide();return;}var c=_basePath+"goodsDetail/recommandProduces.htm?t="+new Date().getTime()+"&filter=false";var e={title:d,pageSize:3};Ajax.post(c,e,function(f){var g=0;$.each(f,function(h,j){$.each(j.shopList,function(l,n){n.Picture=n.Picture.replace("img.b5m.com","tfs01.b5mcdn.com");var o=$('<li class="grid-ls"></li>');var k=_basePath+"item/"+n.DOCID+".html";var m='<div class="grid-mod">'+'<div class="grid-in">'+'<div class="pic-wrap">'+'<div class="pic-mod">'+'<a class="pic" target="_blank" href="'+k+'"><img src="'+n.Picture+'/118x118" lazy-src="'+n.Picture+'/118x118" alt=""></a>'+"</div>"+"</div>"+'<div class="summary"><a target="_blank" href="'+k+'">'+n.Title+"</a></div>"+'<div class="price-mod">'+'<strong class="price"><b>¥</b><span  class="cl-f00">'+n.price+"</span></strong>"+"</div>"+"</div>"+"</div>";if(g<3){o.append(m).appendTo(a);}g++;});});if(g==0){a.parent().parent().hide();}else{a.parent().parent().show();}});},function(){a.parent().parent().hide();});};ResultPage.getRelKeywords=function(b,d,c){var a=_basePath+"/allAutoFill.htm";Ajax.post(a,{keyWord:b},function(e){var f=e.b5mo;var g=null;if(f&&f.length>0){g=f[0].value;if(g==b&&f.length>1){g=f[1].value;}}d(g);});};var Ajax={};Ajax.post=function(a,b,c){$.ajax({type:"POST",url:a,data:b,success:function(d){c(d);},error:function(){errorback();}});};