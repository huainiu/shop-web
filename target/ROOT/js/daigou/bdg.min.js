function Daigou(){}Daigou.compareShow=function(c,g){Daigou.initBeforShow();if(c.val.isDaigou){setValue(c.val.daigouSource);var b=$(window).height();var e=$(window).width();var f=$("body").outerHeight();var h=$(".bdg_goods").outerHeight();var a=$(".bdg_goods").outerWidth();var i=document.documentElement.scrollTop||document.body.scrollTop;$(".bdg_mask,.bdg_addadressbg").css({"height":f,"minHeight":b});$(".bdg_goods").css({"left":(e-(a+2))/2,"top":(b-(h+2))/2+i});$(".bdg_mask,.bdg_goods").show();if(c.val.isDone){$(".bdg_goods_have").hide();$(".bdg_goods_none").show();}else{$(".bdg_goods_none").hide();$(".bdg_goods_have").show();var d=$(".progress_barcor");$.ajax({url:_basePath+"ontimesku/single.htm",data:{"docId":c.val.daigouSource.DOCID,"url":c.val.daigouSource.originUrl},type:"POST",success:function(j){$(".guige_refresh").html("");Daigou.showGuige(d,j.val);},error:function(j){$(".guige_refresh").html("");Daigou.showGuige(d,j.val);}});}}};Daigou.initBeforShow=function(){$(".buynowbtn").unbind("click");$(".zfbbtn").unbind("click");$(".btnpayment").removeClass("btnpaymentcur");$(".guige_refresh").html("");$(".guige_refresh").hide();$(".bdg_progress_bar").show();};Daigou.show=function(d,b){Daigou.initBeforShow();var e=b;var c=e.attr("docid");var a=e.attr("url");if(d.val.isDaigou){$.ajax({url:_basePath+"ontimeprice/single.htm",data:{"docId":c,"url":a},type:"POST",success:function(f){if(f.val.status==1&&f.val.price&&f.val.price!=-1){d.val.daigouSource.Price=f.val.price;}setValue(d.val.daigouSource);var l=$(window).height();var i=$(window).width();var h=$("body").outerHeight();var g=$(".bdg_goods").outerHeight();var m=$(".bdg_goods").outerWidth();var j=document.documentElement.scrollTop||document.body.scrollTop;$(".bdg_mask,.bdg_addadressbg").css({"height":h,"minHeight":l});$(".bdg_goods").css({"left":(i-(m+2))/2,"top":(l-(g+2))/2+j});$(".bdg_mask,.bdg_goods").show();if(f.val.status==0){$(".bdg_goods_have").hide();$(".bdg_goods_none").show();}else{$(".bdg_goods_none").hide();var k=$(".progress_barcor");$.ajax({url:_basePath+"ontimesku/single.htm",data:{"docId":c,"url":a},type:"POST",success:function(n){Daigou.showGuige(k,n.val);},error:function(n){Daigou.showGuige(k,n.val);}});}}});}};Daigou.showGuige=function(e,g){onBtnClick();e.parent(".bdg_progress_bar").hide().parent(".goods_informationlr").siblings(".guigeboxcurbox").find(".guige_refresh").show();if(!g.skuProps||g.skuProps.length<1){return;}for(var b=0;b<g.skuProps.length;b++){var d=g.skuProps[b];var f=$("<dl></dl>").append("<dt>"+d.name+"</dt>");var h=$("<dd></dd>");f.append(h);f.append('<div class="clear"></div>');var a=$('<ul class="ggxz gg_prop"></ul>');h.append(a);for(var c=0;c<d.props.length;c++){a.append('<li><a href="javascript:void(0)">'+d.props[c]+"<b></b></a></li>");}$(".guige_refresh").append(f);}$(".ggxz>li").click(function(){$(this).addClass("cur").siblings().removeClass("cur");var j=$(".gg_prop");var m=0;var i=getGoodsSpec();var n=g.sku[i];if(n){$("#_goodsPrice").val(n);var l=$(".p-text").val();l=Number(l);modifyPrice(l);}for(var k=0;k<j.length;k++){if($(j[k]).find("li.cur").length>0){m++;}}if(m==j.length){closeggts();}});$(".guige_close").click(function(){closeggts();});};function addDaigoucart(d,b,a,c){$.ajax({type:"post",url:_basePath+"daigoucart/add.htm",async:false,data:{docId:d,priceAvg:b,goodsSpec:a,count:pval},success:function(e){if(typeof c==="function"){c(e);}}});}function onBtnClick(){$(".buynowbtn").click(function(){var b=$(".gg_prop");for(var e=0;e<b.length;e++){if($(b[e]).find("li.cur").length<=0){$(".guigeboxcurbox").addClass("guigeboxcur");$(".gg_error_message").show();$(".guige_close").css({"display":"block"});$(".buynowbtn").removeClass("zftbtnbuynow").addClass("zftbtnbuynow_addgg");$(".zfbbtn").removeClass("zftbtnsuccess").addClass("zftbtnsuccess_addgg");return;}}var f=$("#_docId").val();var d=$("#_goodsPriceAvg").val();var a=getGoodsSpec();var c=$(".p-text").val();addDaigoucart(f,d,a,function(g){$(".bdg_mask,.bdg_goods").hide();jumpTo("http://cart.b5m.com");});});$(".zfbbtn").click(function(){var b=$(".gg_prop");for(var e=0;e<b.length;e++){if($(b[e]).find("li.cur").length<=0){$(".guigeboxcurbox").addClass("guigeboxcur");$(".gg_error_message").show();$(".guige_close").css({"display":"block"});$(".buynowbtn").removeClass("zftbtnbuynow").addClass("zftbtnbuynow_addgg");$(".zfbbtn").removeClass("zftbtnsuccess").addClass("zftbtnsuccess_addgg");return;}}var f=$("#_docId").val();var d=$("#_goodsPriceAvg").val();var a=getGoodsSpec();var c=$(".p-text").val();$.ajax({type:"post",url:_basePath+"daigoucart/add.htm",async:false,data:{docId:f,priceAvg:d,goodsSpec:a,count:c},success:function(g){$(".btnpayment").addClass("btnpaymentcur");$(".shoppingimg").addClass("shoppingimgcur");$(".btnpayment").attr("href","http://cart.b5m.com");alert(g.msg);}});});}$(".bodyopen").on("click",function(){var e=$(window).height();var c=$(window).width();var b=$("body").outerHeight();var a=$(".bdg_goods").outerHeight();var f=$(".bdg_goods").outerWidth();var d=document.documentElement.scrollTop||document.body.scrollTop;$(".bdg_mask").css({"height":b,"minHeight":e});$(".bdg_goods").css({"left":(c-(f+2))/2,"top":(e-(a+2))/2+d});$(".bdg_mask,.bdg_goods").show();});function closeggts(){$(".guigeboxcurbox").removeClass("guigeboxcur");$(".gg_error_message,.guige_close").hide();$(".buynowbtn").removeClass("zftbtnbuynow_addgg").addClass("zftbtnbuynow");$(".zfbbtn").removeClass("zftbtnsuccess_addgg").addClass("zftbtnsuccess");}function getGoodsSpec(){var a="";$(".gg_prop .cur").each(function(){var b=$(this).parent().parent().siblings("dt").text();var c=$(this).children("a").text();a=a+b+":"+c+";";});if(a.length>0&&a.charAt(a.length-1)==";"){a=a.substring(0,a.length-1);}return a;}function modifyPrice(d){var c=$("#_goodsPriceAvg").val();var b=$("#_goodsPrice").val();if(parseFloat(c)<parseFloat(b)){$("#_goodsPriceAvg").val(b);c=b;}var a=(parseFloat(c)-parseFloat(b))*d;$("#averageprice").html("<span>¥</span>"+c);$("#daigouprice").html("<span>¥</span>"+b);$("#remainprice").html("<span>¥</span>"+a.toFixed(2));$(".price_listz").html(" <span>¥"+parseFloat(parseFloat(b)*d).toFixed(2)+"</span>总价");}$(function(){$(".closeall").click(function(a){a.stopPropagation();$(".bdg_mask,.bdg_goods").hide();});$(".closetishi").click(function(){$(".bdg_tishi").hide();$(".bdg_addadressbg").hide();$(".bdg_mask").show();});$(".closesel_ts").click(function(){$(".bdgselest_tishi").hide();$(".bdg_addadressbg").hide();$(".bdg_mask").show();});$(".payfail,.close_zfbbox").click(function(){$(".bdg_addadressbg").hide().css({"z-index":"9999"});$(".bdg_zfbbg").hide();});$(".user_phone").find("b").hover(function(){$(this).addClass("cur");},function(){$(this).removeClass("cur");});$(".p-reducel").click(function(){if(!$(this).hasClass("p-reduceno")){var a=$(".p-text").val();a=Number(Number(a)-Number(1));$(".p-text").val(a);if($(".p-text").val()<=1){$(".p-reducel").addClass("p-reduceno");}else{$(".p-reducel").removeClass("p-reduceno");}modifyPrice(a);}});$(".p-reducer").click(function(){var a=$(".p-text").val();a=Number(Number(a)+Number(1));$(".p-text").val(a);if(isNaN($(".p-text").val())||$(".p-text").val()<=1){$(".p-reducel").addClass("p-reduceno");}else{$(".p-reducel").removeClass("p-reduceno");}modifyPrice(a);});$(".p-text").keyup(function(){if(isNaN($(".p-text").val())||$(".p-text").val()<=1){$(".p-reducel").addClass("p-reduceno");$(".p-text").val(1);}else{$(".p-reducel").removeClass("p-reduceno");}var a=$(".p-text").val();a=Number(a);modifyPrice(a);});$(".problemicon").hover(function(){$(".b5mcommitment_posbg").show();},function(){$(".b5mcommitment_posbg").hide();});});function jumpTo(b){var c=document.createElement("a");document.body.appendChild(c);c.href=b;c.target="_blank";if(c.click){c.click();}else{try{var a=document.createEvent("Event");a.initEvent("click",true,true);c.dispatchEvent(a);}catch(d){window.localhost.href=b;}}}$(function(){window.onload=a;function a(){var f=$(window).height();var d=$(window).width();var c=$("body").outerHeight();var b=$(".bdg_goodsdelbg").outerHeight();var g=$(".bdg_goodsdelbg").outerWidth();var e=document.documentElement.scrollTop||document.body.scrollTop;$(".bdg_mask").css({"height":c,"minHeight":f});$(".bdg_goodsdelbg").css({"left":(d-g)/2,"top":(f-b)/2+e});}setInterval(a,500);$(".show_bdggoods").click(function(){var f=$(window).height();var d=$(window).width();var c=$("body").outerHeight();var b=$(".bdg_goods").outerHeight();var g=$(".bdg_goods").outerWidth();var e=document.documentElement.scrollTop||document.body.scrollTop;$(".bdg_mask").css({"height":c,"minHeight":f});$(".bdg_goods").css({"left":(d-(g+2))/2,"top":(f-(b+2))/2+e});$(".bdg_mask,.bdg_goods").show();});$(".del_bdggoods").click(function(){$(".bdg_mask,.bdg_goodsdelbg").show();});$(".goodsdel_del,.goodsdel_cansel").click(function(){$(".bdg_mask,.bdg_goodsdelbg").hide();});});function setValue(a){console.log(a.HighPrice+":"+a.Price);if(a.HighPrice<a.Price){a.HighPrice=a.Price;}$("#averageprice").html("<span>¥</span>"+a.HighPrice);$("#daigouprice").html("<span>¥</span>"+a.Price);$("#remainprice").html("<span>¥</span>"+(a.HighPrice-a.Price).toFixed(2));$(".price_listz").html(" <span>¥"+parseFloat(parseFloat(a.Price)).toFixed(2)+"</span>总价");$(".imgbox").find("img").attr("src",a.Picture);$(".zftbtnsuccess").attr("docid",a.DOCID);$(".goodsname").html(a.Title);$("#_goodsPriceAvg").val(a.HighPrice);$("#_goodsPrice").val(parseFloat(a.Price).toFixed(2));$("#_goodsUrl").val(a.Url);$("#_goodsImgUrl").val(a.Picture);$("#_goodsName").val(a.Title);$("#_goodsSource").val(a.Source);$("#_docId").val(a.DOCID);$(".p-text").val(1);}